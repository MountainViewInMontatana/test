import Restore_Utils
import ESP_Utils
import ESP_SheetPriceListForm
import os
import ESP_PageUtils
import formFind
import ESP_ResourceUtils
import formSheetPriceListDetails
import formSheetPriceRuleDetails
import formSheetPriceTableCreate
import formSheetOrderCreate
import General_ESP_Utils

@given("I have different type of price type")
def ScriptToSetupForSheetPriceRule():
  BaseLineFilePath= ProjectSuite.Path + "FileStores\\ESP\\SheetPriceList"
  scriptName = "SheetPriceRule.sql"
  ScriptToSetupForSheetPriceRule = os.path.join(BaseLineFilePath, scriptName)
  KIWI.esp.runsqlscript(ScriptToSetupForSheetPriceRule)

@given("Sheetprice Midwest Fibre is open")
def openAnExitingSheetPriceList():
  ESP_Utils.viewHomeScreen()
  ESP_PageUtils.mainMenuSelectItem("Search|Price Lists|Sheet Price List")
  Delay (1000)
  formFind.FIND_frmFind()
  formFind.CLICK_SearchButton()
  ESP_ResourceUtils.rowItemOnfxGrid("frmFind", "Midwest Fibre","Name", False, True, False) 

 
@when("User create a new price table")
def createnewpricetable():
  formSheetPriceListDetails.FIND_frmSheetPriceListDetails()
  formSheetPriceListDetails.CLICK_cmdFuture()
  frmSheetPriceTableCreate = formSheetPriceTableCreate.FIND_frmSheetPriceTableCreate()
  formSheetPriceTableCreate.CLICK_cmdCreate()
  ESP_Utils.ifWindowIsFoundClickItsButton(None, {'buttonToPush':'OK', 'windowCaption':'Sheet Price List:'})
  
@when("User select to save the sheetpricelist")
def SaveSheetPriceList():
  formSheetPriceListDetails.FIND_frmSheetPriceListDetails()
  formSheetPriceListDetails.CLICK_btnSave()
  
@then("New price is created")
def VerifyNewPriceCreated():
  SheetPriceListDetails = formSheetPriceListDetails.FIND_frmSheetPriceListDetails()
  tabName = "4/1/2020"
  ESP_PageUtils.tabPageClick(tabName,SheetPriceListDetails,False)
  activeDate = formSheetPriceListDetails.GET_calActiveDate()
  if aqObject.CheckProperty(activeDate.Value, "OleValue", cmpEqual, "4/1/2020" ) == True:
         Log.Message("Active date is 4/1/2020")
        
@given("User select {arg}")
def DoubleClickPriceRule(PriceRule):
   frmSheetPriceListDetails = formSheetPriceListDetails.FIND_frmSheetPriceListDetails()
   names = ["clrFullClassName", "WinFormsControlName"]
   values = ["System.Windows.Forms.ListBox", "lstPriceRules"]
   sheetPriceRuleList = ESP_ResourceUtils.findChildEx(frmSheetPriceListDetails, names, values)
   sheetPriceRuleList.DblClickItem(PriceRule)
     
@when("Price rule form is opened")
def PriceRuleOpen():
    formSheetPriceRuleDetails.FIND_frmSheetPriceRuleDetails()

@then("Price type is {arg}")
def verifyPriceType(PriceType):
  formSheetPriceRuleDetails.FIND_frmSheetPriceRuleDetails()
  params = {"expected":f"{PriceType}"}
  formSheetPriceRuleDetails.VALIDATE_cboPriceType(params)
  formSheetPriceRuleDetails.CLICK_btnCancel()
